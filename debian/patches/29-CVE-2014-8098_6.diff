From 44ba149f28ece93c2fbfc9cc980588de5322dd4b Mon Sep 17 00:00:00 2001
From: Adam Jackson <ajax@redhat.com>
Date: Mon, 10 Nov 2014 12:13:46 -0500
Subject: glx: Length-checking for non-generated vendor private requests
 [CVE-2014-8098 6/8]

Reviewed-by: Keith Packard <keithp@keithp.com>
Reviewed-by: Michal Srb <msrb@suse.com>
Reviewed-by: Andy Ritger <aritger@nvidia.com>
Signed-off-by: Adam Jackson <ajax@redhat.com>
Signed-off-by: Alan Coopersmith <alan.coopersmith@oracle.com>

[hertzog@debian.org: Backported to apply on version 1.7.7]
--- a/glx/indirect_program.c
+++ b/glx/indirect_program.c
@@ -71,6 +71,8 @@ int DoGetProgramString(struct __GLXclien
     ClientPtr client = cl->client;
 
 
+    REQUEST_FIXED_SIZE(xGLXVendorPrivateWithReplyReq, 8);
+
     pc += __GLX_VENDPRIV_HDR_SIZE;
     if (cx != NULL) {
 	GLenum target;
--- a/glx/swap_interval.c
+++ b/glx/swap_interval.c
@@ -51,6 +51,8 @@ int DoSwapInterval(__GLXclientState *cl,
     GLint interval;
 
 
+    REQUEST_FIXED_SIZE(xGLXVendorPrivateReq, 4);
+
     cx = __glXLookupContextByTag(cl, tag);
 
     LogMessage(X_ERROR, "%s: cx = %p, GLX screen = %p\n", __func__,
